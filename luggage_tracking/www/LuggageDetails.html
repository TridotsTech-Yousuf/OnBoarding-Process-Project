<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Passenger Verification</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;800&display=swap" rel="stylesheet">
  <script src="https://kit.fontawesome.com/65eed8ca1e.js" crossorigin="anonymous"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: "Nunito", sans-serif;
      background-color: #f7f8f8;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 30px;
    }

    nav {
      width: 100%;
      display: flex;
      justify-content: flex-end;
      align-items: center;
      gap: 10px;
    }

    nav a {
        padding: 3px 15px;
        text-decoration: none;
        font-size: 12px;
        font-weight: 800;
        line-height: 29px;
        text-transform: uppercase;
        color:#383c42;
    }

    nav a.active,
    nav a:hover {
        background-color: #383c42;
        color: white;
        border-radius: 5px;
    }

    #Passenger-Verification {
      margin-top: 35px;
    }

    #Passenger-Verification > div {
        padding: 0 40px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    #Passenger-Verification h1 {
      color: #b61032;
      font-size: 20px;
      font-weight: 800;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    #Passenger-Verification div div {
      border: 1.5px solid #383c42;
      border-radius: 4px;
      display: flex;
      align-items: center;
      padding: 3px 10px;
      background-color: white;
    }

    #Passenger-Verification div div:focus-within {
      border-color: #b61032;
    }

    #Passenger-Verification div div:focus-within label {
      color: #b61032;
    }

    #Passenger-Verification input {
      border: none;
      outline: none;
      padding: 5px;
      font-size: 14px;
    }

    #Passenger-Verification label {
      font-size: 14px;
      color: #383c42;
      margin-left: 8px;
    }

    table {
      width: 90%;
      border-collapse: collapse;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
      margin: 0 auto;
      margin-top: 20px;
    }

    th, td {
      padding: 8px;
      text-align: center;
    }

    th {
      background-color: #ededed;
      font-size: 14px;
    }

    tbody tr:nth-child(even) {
      background-color: #f5f5f5;
    }

    tbody tr:nth-child(odd) {
      background-color: white;
    }

    tbody tr{
        font-size: 12px;
    }

    tbody tr:hover {
        background-color: #e0e0e0;
    }

    .btn-designs{
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
    }

    .more-btn {
      background-color: #b61032;
      /* width: 100%; */
      color: gold;
      border: none;
      padding: 10px 15px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 700;
      font-size: 10px;
    }

    .more-btn:hover {
      background-color: none;
      background-image: linear-gradient(to right, gold, goldenrod);
      color:#b61032;
    }

    .luggage-details-btn{
        background-image: linear-gradient(to right, gold, goldenrod);
        color: #b61032;
      /* width: 100%; */
      border: none;
      padding: 10px 10px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 700;
      font-size: 10px;
    }

    .luggage-details-btn:hover{
      background-color: #b61032;
      background-image: none;
      color: gold;
    }

    #popup-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0,0,0,0.6);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 999;
}

#popup-content {
  background-color: white;
  padding: 20px 30px;
  border-radius: 8px;
  width: 400px;
  max-width: 90%;
  box-shadow: 0 8px 16px rgba(0,0,0,0.3);
  position: relative;
  animation: fadeIn 0.3s ease;
}

#close-popup {
  position: absolute;
  top: 8px;
  right: 12px;
  font-size: 22px;
  cursor: pointer;
  color: #b61032;
}

#details-body {
  margin-top: 20px;
  font-size: 14px;
  line-height: 1.6;
}

@keyframes fadeIn {
  from { opacity: 0; transform: scale(0.9); }
  to { opacity: 1; transform: scale(1); }
}

  </style>
</head>
<body>
  <header>
            <svg width="200" height="71" viewBox="0 0 200 71" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M66.1256 43.3782C67.7078 42.4741 68.7147 40.7685 68.7147 38.6931C68.7147 34.0902 65.4064 32.5696 59.55 32.5696H49.3784V48.166H54.3717V44.8988H59.5705C60.3514 44.8988 61.0911 44.8577 61.7693 44.7755C62.6939 45.6796 63.4953 47.1386 63.8241 48.1455H69.0024C68.4476 46.481 67.3585 44.5084 66.1256 43.3782ZM59.7966 41.3028H54.3717V36.1656H59.7966C62.4268 36.1656 63.9269 36.6382 63.9269 38.6931C63.9063 40.7685 62.4268 41.3028 59.7966 41.3028Z" fill="#DA0E29"/>
            <path d="M45.3509 32.5696H40.3575V48.166H45.3509V32.5696Z" fill="#DA0E29"/>
            <path d="M85.5851 32.5696H80.5918V48.166H85.5851V32.5696Z" fill="#DA0E29"/>
            <path d="M141.539 32.5696H136.546V48.166H141.539V32.5696Z" fill="#DA0E29"/>
            <path d="M123.538 32.5696H113.675V48.166H123.538C129.333 48.166 133.607 45.5564 133.607 40.3575C133.607 35.1587 129.333 32.5696 123.538 32.5696ZM122.943 44.4467H118.668V36.2889H122.943C126.662 36.2889 128.635 37.604 128.635 40.3575C128.635 43.1111 126.662 44.4467 122.943 44.4467Z" fill="#DA0E29"/>
            <path d="M104.86 39.6794C101.88 36.3506 98.2842 33.9464 93.8252 32.5696H89.5921V48.166H94.38V37.6246C98.9418 39.1041 103.154 43.7481 105.23 48.166H109.627V32.5696H104.839V39.6794H104.86Z" fill="#DA0E29"/>
            <path d="M23.5077 32.5696C20.2199 36.2889 15.5964 42.5563 15.5964 48.166H20.5692C20.5692 47.3235 20.672 46.4605 20.8774 45.618H32.1997C32.4052 46.481 32.508 47.3235 32.508 48.166H37.4807C37.4807 42.5563 32.8573 36.2889 29.5695 32.5696H23.5077ZM22.0076 42.3302C23.22 39.6794 24.9872 37.2136 26.5283 35.4259C28.0695 37.2136 29.8366 39.6794 31.049 42.3302H22.0076Z" fill="#DA0E29"/>
            <path d="M158.389 32.5696H152.327C149.039 36.2889 144.416 42.5563 144.416 48.166H149.389C149.389 47.3235 149.491 46.4605 149.697 45.618H161.019C161.225 46.481 161.327 47.3235 161.327 48.166H166.3C166.3 42.5357 161.677 36.2889 158.389 32.5696ZM150.827 42.3302C152.039 39.6794 153.807 37.2136 155.348 35.4259C156.889 37.2136 158.656 39.6794 159.868 42.3302H150.827Z" fill="#DA0E29"/>
            <path d="M183.808 42.433C184.219 39.3918 183.479 36.7615 182.862 35.0354C182.431 33.8231 182.082 32.8573 181.773 31.9942C180.376 28.0695 180.109 27.3502 179.143 23.4255L178.814 22.1309L177.54 21.7199C173.677 20.4665 172.999 20.1582 169.177 18.4527C168.335 18.0828 167.389 17.6513 166.218 17.1376C164.841 16.5417 162.745 15.7197 160.218 15.6375C156.334 15.4937 152.615 17.0759 149.142 20.3226L149.204 20.3021C148.32 21.0829 147.416 21.9871 146.491 23.035C146.491 23.035 146.512 23.0967 146.717 22.9323C147.93 21.946 151.896 18.2472 162.684 23.0967C167.985 25.4803 173.081 27.5968 173.081 27.5968C173.081 27.5968 174.746 32.8367 176.657 38.3438C180.54 49.5017 176.513 53.1388 175.424 54.2484C175.259 54.4334 175.321 54.4539 175.321 54.4539C176.883 53.3237 178.136 52.1936 179.184 51.0839C181.814 48.4332 183.376 45.5358 183.808 42.433Z" fill="url(#paint0_linear_7441_1544)"/>
            <path d="M178.835 22.0898L177.561 21.6788C173.698 20.4254 173.02 20.1171 169.198 18.4116C168.355 18.0417 167.41 17.6102 166.239 17.0965C164.862 16.5006 162.766 15.6786 160.238 15.5964C156.355 15.4526 152.635 17.0348 149.163 20.2815L149.224 20.261C148.341 21.0418 147.437 21.946 146.512 22.9939C146.512 22.9939 146.532 23.0556 146.738 22.8912C147.95 21.9049 151.916 18.2061 162.704 23.0556C168.006 25.4392 173.102 27.5557 173.102 27.5557L178.835 22.0898Z" fill="#FED9A0"/>
            <defs>
            <linearGradient id="paint0_linear_7441_1544" x1="198.42" y1="71.1854" x2="157.529" y2="15.5605" gradientUnits="userSpaceOnUse">
            <stop offset="0.1805" stop-color="#FED9A0"/>
            <stop offset="0.3124" stop-color="#ECC890"/>
            <stop offset="0.5738" stop-color="#BF9A66"/>
            <stop offset="0.7464" stop-color="#9E7947"/>
            </linearGradient>
            </defs>
        </svg>
    <nav>
      <a href="PassengerVerification.html">Passengers Verification List</a>
      <a href="VerifiedPassengers.html">Verified Passengers List</a>
      <a href="LuggageDetails.html">Luggage Details</a>
      <a href="BoardedPassengers.html">Boarded Passengers List</a>
    </nav>

  </header>

<section id="Passenger-Verification">
    <div>
      <h1>Passenger Verification List</h1>
      <div>
        <input type="text" id="search-box" placeholder="Search Passenger Name" />
        <label for="search-box"><i class="fa-solid fa-magnifying-glass"></i></label>
      </div>
    </div>

  <table id="luggage-table">
    <thead>
      <tr>
        <th>Passenger Name</th>
        <th>Phone Number</th>
        <th>Departure Airport</th>
        <th>Arrival Airport</th>
        <!-- <th>Luggage Type</th> -->
        <th>Seat Number</th>
        <!-- <th>Luggage Status</th> -->
        <th>Details</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</section>


<!-- Popup Modal -->
<!-- <div id="popup-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); justify-content:center; align-items:center;">
  <div style="background:white; padding:20px; border-radius:10px; min-width:300px;">
    <div id="details-body"></div>
    <button id="close-popup" style="margin-top:10px;">Close</button>
  </div>
</div> -->

  <div id="popup-modal" style="display:none;">
  <div id="popup-content">
    <span id="close-popup">&times;</span>
    <div id="details-body"></div>
  </div>
</div>


<script>
let luggageData = [];

function renderLuggageTable(data) {
  const tableBody = document.querySelector("#luggage-table tbody");
  tableBody.innerHTML = "";

  if (data.length > 0) {
    const duplicateNames = [];
    const excludedNames = [];
    const passengerCheckinMap = {};
    const passengerCabinMap = {};

    // Step 1: Build luggage summary per passenger
    data.forEach((record) => {
      const name = record.passenger_name || "Unknown";
      const weight = parseFloat(record.weight || 0);

      if (record.luggage_type === "Check IN") {
        if (!passengerCheckinMap[name]) {
          passengerCheckinMap[name] = { count: 0, totalWeight: 0 };
        }
        passengerCheckinMap[name].count += 1;
        passengerCheckinMap[name].totalWeight += weight;
      }

      // console.log(record.luggage_type === "Cabin");

      if (record.luggage_type === "Cabin") {
        if (!passengerCabinMap[name]) {
          passengerCabinMap[name] = { count: 0, totalWeight: 0 };
        }
        passengerCabinMap[name].count += 1;
        passengerCabinMap[name].totalWeight += weight;
      }
    });

    // Step 2: Render table (one row per passenger)
    data.forEach((record) => {
      if (duplicateNames.includes(record.passenger_name)) {
        excludedNames.push(record.passenger_name);
        return;
      }

      duplicateNames.push(record.passenger_name);

      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${record.passenger_name || 'Not Available'}</td>
        <td>${record.phone_number || 'Not Assigned'}</td>
        <td>${record.departure_airport || 'N/A'}</td>
        <td>${record.arrival_airport || 'N/A'}</td>
        <td>${record.seat_number || 'Not Assigned'}</td>
        <td class="btn-designs">
          <button class="more-btn" data-json='${JSON.stringify(record).replace(/'/g, "&#39;")}'>More</button>
          <button class="luggage-details-btn" data-json='${JSON.stringify(record).replace(/'/g, "&#39;")}'>Luggage Details</button>
        </td>
      `;
      tableBody.appendChild(row);
    });

    // Step 3: Attach button handlers
    document.querySelectorAll(".more-btn").forEach(btn => {
      btn.addEventListener("click", function () {
        try {
          const data = JSON.parse(this.dataset.json.replace(/&#39;/g, "'"));
          showMoreDetails(data);
        } catch (e) {
          console.error("Failed to parse JSON data:", e);
        }
      });
    });

    document.querySelectorAll(".luggage-details-btn").forEach(btn => {
      btn.addEventListener("click", function () {
        try {
          const data = JSON.parse(this.dataset.json.replace(/&#39;/g, "'"));
          console.log(passengerCheckinMap);
          console.log(passengerCabinMap,"-------------------------");
          showLuggageDetails(data, passengerCheckinMap, passengerCabinMap);
        } catch (e) {
          console.error("Failed to parse JSON data:", e);
        }
      });
    });

  } else {
    tableBody.innerHTML = `<tr><td colspan="6">No luggage records found</td></tr>`;
  }
}

function getLuggageDetails() {
  fetch('/api/method/luggage_tracking.api.get_luggage_details')
    .then(response => response.json())
    .then(data => {
      if (data.message.status === "success") {
        luggageData = data.message.data;
        console.log(data);
        renderLuggageTable(luggageData);
      } else {
        renderLuggageTable([]);
      }
    })
    .catch(error => {
      console.error("Error fetching luggage details:", error);
      document.querySelector("#luggage-table tbody").innerHTML =
        `<tr><td colspan="6">Error loading data</td></tr>`;
    });
}

function showMoreDetails(record) {
  const modal = document.getElementById("popup-modal");
  const content = document.getElementById("details-body");

  content.innerHTML = `
    <strong>Passenger Name:</strong> ${record.passenger_name || 'N/A'}<br>
    <strong>Phone Number:</strong> ${record.phone_number || 'N/A'}<br>
    <strong>Departure:</strong> ${record.departure_airport || 'N/A'}<br>
    <strong>Arrival:</strong> ${record.arrival_airport || 'N/A'}<br>
    <strong>Seat Number:</strong> ${record.seat_number || 'N/A'}<br>
    <strong>Luggage Type:</strong> ${record.luggage_type || 'N/A'}<br>
    <strong>Status:</strong> ${record.status || 'N/A'}<br>
    <strong>Weight:</strong> ${record.weight || 'N/A'} kg<br>   
  `;
  modal.style.display = "flex";
}

function showLuggageDetails(record, checkinMap, cabinMap) {
  const modal = document.getElementById("popup-modal");
  const content = document.getElementById("details-body");

  // console.log("Check IN: ",checkinMap);
  // console.log("Cabin: ",cabinMap);

  const name = record.passenger_name || "Unknown";
  const checkin = checkinMap[name] || { count: 0, totalWeight: 0 };
  const cabin = cabinMap[name] || { count: 0, totalWeight: 0 };

  content.innerHTML = `
    <strong>Passenger Name:</strong> ${name}<br><br>
    <u><strong>Check-in Luggage</strong></u><br>
    Bags: ${checkin.count}<br>
    Total Weight: ${checkin.totalWeight} kg<br><br>
    <u><strong>Cabin Luggage</strong></u><br>
    Bags: ${cabin.count}<br>
    Total Weight: ${cabin.totalWeight} kg
  `;

  modal.style.display = "flex";
}

document.getElementById("close-popup").onclick = function () {
  document.getElementById("popup-modal").style.display = "none";
};

window.onclick = function (event) {
  if (event.target.id === "popup-modal") {
    document.getElementById("popup-modal").style.display = "none";
  }
};

document.addEventListener("DOMContentLoaded", () => {
  const navLinks = document.querySelectorAll("nav a");
  const currentPage = window.location.pathname.split("/").pop();

  navLinks.forEach(link => {
    const hrefPage = link.getAttribute("href").split("/").pop();
    if (hrefPage === currentPage) {
      link.classList.add("active");
    }
  });

  const searchBox = document.getElementById("search-box");
  searchBox.addEventListener("input", (e) => {
    const keyword = e.target.value.trim().toLowerCase();
    const filtered = luggageData.filter(p =>
      p.passenger_name && p.passenger_name.toLowerCase().includes(keyword)
    );
    renderLuggageTable(filtered);
  });

  getLuggageDetails(); // Initial fetch
});
</script>






</body>
</html>
 